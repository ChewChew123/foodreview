<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬æ¥è¥¿äºšè¡—å¤´ç¾é£Ÿè¯„ä»·ç³»ç»Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .food-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .food-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        
        .food-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(to right, #4b6cb7, #182848);
            color: white;
        }
        
        .food-emoji {
            font-size: 3rem;
            margin-right: 15px;
        }
        
        .rating-section {
            flex-grow: 1;
        }
        
        .stars {
            color: #ffc107;
            font-size: 1.4rem;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }
        
        .star {
            cursor: default;
        }
        
        .star.clickable {
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
        }
        
        .star.clickable:hover {
            transform: scale(1.3);
        }
        
        .star.filled {
            color: #ffc107;
        }
        
        .review-count {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .food-content {
            padding: 20px;
        }
        
        .food-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .food-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .food-location {
            display: flex;
            align-items: center;
            color: #e74c3c;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .location-icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .latest-review {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .latest-review-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .latest-review-text {
            font-style: italic;
            color: #34495e;
        }
        
        .detail-view {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .detail-view.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-emoji {
            font-size: 4rem;
            margin-right: 20px;
        }
        
        .detail-info h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .detail-info p {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .detail-location {
            display: flex;
            align-items: center;
            color: #e74c3c;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .detail-rating {
            display: flex;
            align-items: center;
        }
        
        .detail-rating .stars {
            margin-right: 10px;
            margin-bottom: 0;
        }
        
        .reviews-section {
            margin-top: 25px;
        }
        
        .reviews-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .review-item {
            padding: 18px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .reviewer-info {
            display: flex;
            align-items: center;
        }
        
        .reviewer-avatar {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
        }
        
        .reviewer-details h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .review-time {
            color: #95a5a6;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .review-time span {
            margin-right: 5px;
        }
        
        .review-comment {
            color: #34495e;
            line-height: 1.5;
        }
        
        .review-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
            display: none;
        }
        
        .review-form.active {
            display: block;
            animation: slideDown 0.4s ease;
        }
        
        .review-form h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .rating-input {
            display: flex;
            align-items: center;
        }
        
        .rating-input .stars {
            margin-right: 15px;
        }
        
        .rating-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            background: #fff;
            padding: 5px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-back {
            background: #2c3e50;
            color: white;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
        }
        
        .btn-back:hover {
            background: #1a252f;
        }
        
        .btn-add-review {
            background: #27ae60;
            color: white;
            margin-top: 15px;
        }
        
        .btn-add-review:hover {
            background: #219653;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .debug-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #e74c3c;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .food-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-header {
                flex-direction: column;
                text-align: center;
            }
            
            .detail-emoji {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .review-time {
                margin-top: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>é©¬æ¥è¥¿äºšè¡—å¤´ç¾é£Ÿ</h1>
        <p class="subtitle">æ¢ç´¢å¹¶è¯„ä»·é©¬æ¥è¥¿äºšæœ€å—æ¬¢è¿çš„è¡—å¤´ç¾é£Ÿ</p>
    </header>

    <main>
        <section id="main-view">
            <div class="food-grid" id="food-grid">
                <!-- é£Ÿç‰©å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <section id="detail-view" class="detail-view">
            <button class="btn btn-back" onclick="showMainView()">â† è¿”å›åˆ—è¡¨</button>
            
            <div class="detail-header" id="detail-header">
                <!-- è¯¦ç»†å¤´éƒ¨ä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div class="reviews-section">
                <h2>ç”¨æˆ·è¯„ä»·</h2>
                <div id="reviews-list">
                    <!-- è¯„ä»·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-add-review" onclick="toggleReviewForm()">å†™è¯„ä»·</button>
            </div>

            <div id="review-form" class="review-form">
                <h3>å†™è¯„ä»·</h3>
                <div class="form-group">
                    <label for="reviewer-name">æ‚¨çš„åå­—</label>
                    <input type="text" id="reviewer-name" placeholder="è¯·è¾“å…¥æ‚¨çš„åå­—">
                </div>
                
                <div class="form-group">
                    <label for="review-comment">æ‚¨çš„è¯„ä»·</label>
                    <textarea id="review-comment" placeholder="è¯·åˆ†äº«æ‚¨çš„ä½“éªŒ..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>è¯„åˆ†</label>
                    <div class="rating-input">
                        <div class="stars" id="rating-stars">
                            <!-- æ˜Ÿæ˜Ÿå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <div class="rating-value" id="rating-value">5æ˜Ÿ</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" onclick="submitReview()">æäº¤è¯„ä»·</button>
                    <button class="btn btn-secondary" onclick="toggleReviewForm()">å–æ¶ˆ</button>
                </div>
            </div>
        </section>
    </main>

    <div class="debug-panel">
        <h3>è°ƒè¯•ä¿¡æ¯</h3>
        <p>å½“å‰è¯„åˆ†: <span id="debug-rating">5</span>æ˜Ÿ | å½“å‰é£Ÿç‰©ID: <span id="debug-food-id">-</span></p>
        <button class="btn btn-secondary" onclick="debugCheckData()">æ£€æŸ¥æ•°æ®å®Œæ•´æ€§</button>
        <button class="btn btn-secondary" onclick="resetToDefault()">é‡ç½®æ•°æ®</button>
    </div>

    <script>
        // è¡—å¤´ç¾é£Ÿæ•°æ®ï¼ˆè‡ªåŠ¨ä¿å­˜åˆ°localStorageï¼‰
        let streetFoods = [];
        // é»˜è®¤æ•°æ®
        const defaultStreetFoods = [
            {
                id: 1,
                name: "Char Kway Teow",
                location: "Penang Road, George Town",
                emoji: "ğŸœ",
                description: "ç‚’ç²¿æ¡ï¼Œé©¬æ¥è¥¿äºšç»å…¸è¡—å¤´ç¾é£Ÿï¼Œä½¿ç”¨å¤§ç«ç‚’åˆ¶çš„æ‰ç²‰æ¡é…è™¾ã€è›¤èœŠå’ŒéŸ­èœ",
                reviews: [
                    { user: "Ahmad", rating: 5, comment: "Best char kway teow in Penang! The wok hei is perfect!", time: "2å¤©å‰" },
                    { user: "Siti", rating: 5, comment: "Amazing flavors, perfectly charred noodles", time: "1å‘¨å‰" },
                    { user: "Raj", rating: 4, comment: "Great taste but a bit oily", time: "2å‘¨å‰" }
                ]
            },
            {
                id: 2,
                name: "Nasi Lemak",
                location: "Kampung Baru, Kuala Lumpur",
                emoji: "ğŸ›",
                description: "æ¤°æµ†é¥­ï¼Œé©¬æ¥è¥¿äºšå›½èœï¼Œé¦™æµ“æ¤°æµ†ç…®åˆ¶çš„ç±³é¥­é…å‚å·´é…±ã€èŠ±ç”Ÿå’Œé»„ç“œ",
                reviews: [
                    { user: "Fatimah", rating: 5, comment: "Authentic taste, love the sambal!", time: "1å¤©å‰" },
                    { user: "Chen Wei", rating: 4, comment: "Good portion size and fresh ingredients", time: "3å¤©å‰" },
                    { user: "Kumar", rating: 5, comment: "Best nasi lemak in KL!", time: "1å‘¨å‰" }
                ]
            },
            {
                id: 3,
                name: "Roti Canai",
                location: "Jalan Alor, Kuala Lumpur",
                emoji: "ğŸ«“",
                description: "å°åº¦ç…é¥¼ï¼Œé…å’–å–±è˜¸æ–™ï¼Œå±‚æ¬¡åˆ†æ˜çš„è–„é¥¼æ­é…é¦™æµ“å’–å–±",
                reviews: [
                    { user: "Muthu", rating: 5, comment: "Crispy and fluffy, excellent curry", time: "3å¤©å‰" },
                    { user: "Sarah", rating: 4, comment: "Good but could be crispier", time: "6å¤©å‰" },
                    { user: "Ali", rating: 4, comment: "Love the dhal curry!", time: "1å‘¨å‰" }
                ]
            },
            {
                id: 4,
                name: "Cendol",
                location: "Jonker Street, Melaka",
                emoji: "ğŸ§",
                description: "ç…è•Šï¼Œé©¬æ¥è¥¿äºšä¼ ç»Ÿç”œå“ï¼Œç»¿è‰²ç²‰æ¡é…æ¤°æµ†å’Œæ£•æ¦ˆç³–æµ†",
                reviews: [
                    { user: "Lim", rating: 4, comment: "Refreshing dessert, perfect for hot weather", time: "5å¤©å‰" },
                    { user: "Aisha", rating: 5, comment: "Love the gula melaka!", time: "1å‘¨å‰" },
                    { user: "Wong", rating: 3, comment: "A bit too sweet for my taste", time: "2å‘¨å‰" }
                ]
            },
            {
                id: 5,
                name: "Laksa",
                location: "Gurney Drive, Penang",
                emoji: "ğŸ²",
                description: "å»æ²™ï¼Œé…¸è¾£é¢æ±¤ï¼Œæµ“éƒæ¤°æµ†æ±¤åº•é…ç±³ç²‰å’Œå„ç§é…èœ",
                reviews: [
                    { user: "David", rating: 4, comment: "Spicy and tangy, authentic flavor", time: "4å¤©å‰" },
                    { user: "Priya", rating: 3, comment: "Too spicy for me but good taste", time: "1å‘¨å‰" },
                    { user: "Hassan", rating: 5, comment: "Best laksa I've ever had!", time: "2å‘¨å‰" }
                ]
            }
        ];

        let currentFood = null;
        let currentRating = 5; // é»˜è®¤ä»5æ˜Ÿå¼€å§‹

        // localStorage æ•°æ®ç®¡ç†
        function saveToLocalStorage() {
            try {
                localStorage.setItem('malaysiStreetFoods', JSON.stringify(streetFoods));
                console.log('æ•°æ®å·²ä¿å­˜åˆ° localStorage');
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedFoods = localStorage.getItem('malaysiStreetFoods');
                if (savedFoods) {
                    streetFoods = JSON.parse(savedFoods);
                    console.log('ä» localStorage åŠ è½½æ•°æ®æˆåŠŸ');
                    return true;
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
            return false;
        }

        function resetToDefault() {
            streetFoods = JSON.parse(JSON.stringify(defaultStreetFoods));
            saveToLocalStorage();
            renderFoodGrid();
            alert('æ•°æ®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
        }

        // è®¡ç®—å¹³å‡è¯„åˆ† (ç¡®ä¿æ­£ç¡®è®¡ç®—)
        function calculateAverageRating(reviews) {
            if (!reviews || reviews.length === 0) return 0;
            
            const total = reviews.reduce((sum, review) => {
                const rating = parseInt(review.rating) || 0;
                return sum + rating;
            }, 0);
            
            const average = total / reviews.length;
            return average.toFixed(1);
        }

        // ç”Ÿæˆæ˜Ÿæ˜ŸHTML (å®Œå…¨ä¿®å¤ç‰ˆ)
        function generateStars(rating, isClickable = false) {
            let starsHTML = '';
            const numericRating = parseFloat(rating) || 0; // ç¡®ä¿æ˜¯æ•°å­—
            
            for (let i = 1; i <= 5; i++) {
                const filled = i <= numericRating;
                const classes = `star ${filled ? 'filled' : ''} ${isClickable ? 'clickable' : ''}`;
                if (isClickable) {
                    starsHTML += `<span class="${classes}" onclick="setRating(${i})" data-rating="${i}">â˜…</span>`;
                } else {
                    starsHTML += `<span class="${classes}">â˜…</span>`;
                }
            }
            return starsHTML;
        }

        // æŒ‰è¯„åˆ†æ’åºå¹¶æ¸²æŸ“é£Ÿç‰©å¡ç‰‡ (ä¿®å¤è¯„åˆ†æ˜¾ç¤º)
        function renderFoodGrid() {
            // é‡æ–°è®¡ç®—æ¯ä¸ªé£Ÿç‰©çš„å¹³å‡è¯„åˆ†ç„¶åæ’åº
            const sortedFoods = [...streetFoods].sort((a, b) => {
                const avgA = parseFloat(calculateAverageRating(a.reviews));
                const avgB = parseFloat(calculateAverageRating(b.reviews));
                return avgB - avgA;
            });

            const gridHTML = sortedFoods.map(food => {
                const averageRating = parseFloat(calculateAverageRating(food.reviews));
                const totalReviews = food.reviews.length;
                const latestReview = food.reviews[0] || { comment: "æš‚æ— è¯„ä»·" };
                
                return `
                    <div class="food-card" onclick="showDetailView(${food.id})">
                        <div class="food-header">
                            <div class="food-emoji">${food.emoji}</div>
                            <div class="rating-section">
                                <div class="stars">
                                    ${generateStars(averageRating)}
                                </div>
                                <div class="review-count">${totalReviews} è¯„ä»·</div>
                            </div>
                        </div>
                        
                        <div class="food-content">
                            <div class="food-name">${food.name}</div>
                            <div class="food-description">${food.description}</div>
                            
                            <div class="food-location">
                                <span class="location-icon">ğŸ“</span>
                                ${food.location}
                            </div>
                            
                            <div class="latest-review">
                                <div class="latest-review-label">æœ€æ–°è¯„ä»·:</div>
                                <div class="latest-review-text">"${latestReview.comment}"</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('food-grid').innerHTML = gridHTML;
        }

        // æ˜¾ç¤ºè¯¦ç»†é¡µé¢ (ä¿®å¤è¯„åˆ†æ˜¾ç¤º)
        function showDetailView(foodId) {
            currentFood = streetFoods.find(food => food.id === foodId);
            if (!currentFood) return;

            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            document.getElementById('debug-food-id').textContent = foodId;

            // é‡æ–°è®¡ç®—å½“å‰é£Ÿç‰©çš„å¹³å‡è¯„åˆ†
            const averageRating = parseFloat(calculateAverageRating(currentFood.reviews));
            const totalReviews = currentFood.reviews.length;

            // æ¸²æŸ“è¯¦ç»†é¡µé¢å¤´éƒ¨
            const headerHTML = `
                <div class="detail-emoji">${currentFood.emoji}</div>
                <div class="detail-info">
                    <h1>${currentFood.name}</h1>
                    <p>${currentFood.description}</p>
                    <div class="detail-location">
                        <span style="margin-right: 8px;">ğŸ“</span>
                        ${currentFood.location}
                    </div>
                    <div class="detail-rating">
                        <div class="stars">
                            ${generateStars(averageRating)}
                        </div>
                        <span style="color: #666;">(${totalReviews} è¯„ä»·)</span>
                    </div>
                </div>
            `;

            document.getElementById('detail-header').innerHTML = headerHTML;
            renderReviews();

            // åˆ‡æ¢è§†å›¾
            document.getElementById('main-view').style.display = 'none';
            document.getElementById('detail-view').classList.add('active');
        }

        // æ˜¾ç¤ºä¸»é¡µ
        function showMainView() {
            document.getElementById('main-view').style.display = 'block';
            document.getElementById('detail-view').classList.remove('active');
            document.getElementById('review-form').classList.remove('active');
        }

        // æ¸²æŸ“è¯„ä»·åˆ—è¡¨ (ä¿®å¤ä¸ªäººè¯„ä»·æ˜Ÿæ˜Ÿæ˜¾ç¤º)
        function renderReviews() {
            const reviewsHTML = currentFood.reviews.map(review => {
                // ç¡®ä¿ratingæ˜¯æ•°å­—ç±»å‹
                const userRating = parseInt(review.rating) || 5;
                
                return `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">${review.user.charAt(0).toUpperCase()}</div>
                                <div class="reviewer-details">
                                    <h4>${review.user}</h4>
                                    <div class="stars">
                                        ${generateStars(userRating)}
                                    </div>
                                </div>
                            </div>
                            <div class="review-time">
                                <span>ğŸ•’</span> ${review.time}
                            </div>
                        </div>
                        <div class="review-comment">${review.comment}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('reviews-list').innerHTML = reviewsHTML;
        }

        // åˆ‡æ¢è¯„ä»·è¡¨å•ï¼ˆæ›´æ–°ç‰ˆï¼Œæ­£ç¡®åˆå§‹åŒ–æ˜Ÿæ˜Ÿï¼‰
        function toggleReviewForm() {
            const form = document.getElementById('review-form');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                // é‡ç½®è¡¨å•
                document.getElementById('reviewer-name').value = '';
                document.getElementById('review-comment').value = '';
                setRating(5); // é‡ç½®ä¸º5æ˜Ÿ
            } else {
                // è¡¨å•æ‰“å¼€æ—¶ï¼Œåˆå§‹åŒ–æ˜Ÿæ˜Ÿå¹¶è®¾ç½®ä¸º5æ˜Ÿ
                initializeRatingStars();
                setRating(5);
                // èšç„¦åˆ°ç”¨æˆ·åè¾“å…¥æ¡†
                setTimeout(() => {
                    document.getElementById('reviewer-name').focus();
                }, 100);
            }
        }

        // æ–°å¢å‡½æ•°ï¼šåˆå§‹åŒ–è¯„åˆ†æ˜Ÿæ˜Ÿ
        function initializeRatingStars() {
            const starsContainer = document.getElementById('rating-stars');
            if (starsContainer) {
                starsContainer.innerHTML = generateStars(5, true);
            }
        }

        // è®¾ç½®è¯„åˆ†ï¼ˆä¿®å¤ç‰ˆï¼Œæ­£ç¡®å¤„ç†æ˜Ÿæ˜ŸçŠ¶æ€ï¼‰
        function setRating(rating) {
            currentRating = parseInt(rating);
            const stars = document.querySelectorAll('#rating-stars .star');
            
            stars.forEach((star) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                star.classList.remove('filled');
                if (starRating <= currentRating) {
                    star.classList.add('filled');
                }
            });
            
            // æ›´æ–°è¯„åˆ†å€¼æ˜¾ç¤º
            document.getElementById('rating-value').textContent = `${currentRating}æ˜Ÿ`;
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            document.getElementById('debug-rating').textContent = currentRating;
            
            // æ·»åŠ è§†è§‰åé¦ˆ
            stars.forEach((star) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= currentRating) {
                    star.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        star.style.transform = 'scale(1)';
                    }, 150);
                }
            });
            
            console.log(`è¯„åˆ†è®¾ç½®ä¸º: ${currentRating}æ˜Ÿ`);
        }

        // æäº¤è¯„ä»·ï¼ˆç¡®ä¿è¯„åˆ†æ­£ç¡®ä¿å­˜ï¼‰
        function submitReview() {
            const name = document.getElementById('reviewer-name').value.trim();
            const comment = document.getElementById('review-comment').value.trim();

            if (!name || !comment) {
                alert('è¯·å¡«å†™ç”¨æˆ·åå’Œè¯„ä»·å†…å®¹');
                return;
            }

            if (currentRating < 1 || currentRating > 5) {
                alert('è¯·é€‰æ‹©1-5æ˜Ÿè¯„åˆ†');
                return;
            }

            const newReview = {
                user: name,
                rating: parseInt(currentRating), // ç¡®ä¿ä¿å­˜ä¸ºæ•´æ•°
                comment: comment,
                time: "åˆšåˆš"
            };

            // æ·»åŠ æ–°è¯„ä»·åˆ°å½“å‰é£Ÿç‰©çš„å¼€å¤´
            currentFood.reviews.unshift(newReview);

            // æ›´æ–°streetFoodsæ•°ç»„ä¸­çš„å¯¹åº”é£Ÿç‰©
            const foodIndex = streetFoods.findIndex(food => food.id === currentFood.id);
            if (foodIndex !== -1) {
                streetFoods[foodIndex] = { ...currentFood };
            }

            // è‡ªåŠ¨ä¿å­˜åˆ°localStorage
            saveToLocalStorage();

            // é‡æ–°è®¡ç®—å¹¶æ›´æ–°è¯¦ç»†é¡µé¢çš„å¹³å‡è¯„åˆ†æ˜¾ç¤º
            updateDetailViewRating();

            // é‡æ–°æ¸²æŸ“è¯„ä»·åˆ—è¡¨
            renderReviews();
            
            // å…³é—­è¯„ä»·è¡¨å•
            toggleReviewForm();
            
            // æ›´æ–°ä¸»é¡µç½‘æ ¼ï¼ˆé‡æ–°æ’åºå’Œæ˜¾ç¤ºæ–°çš„å¹³å‡è¯„åˆ†ï¼‰
            renderFoodGrid();

            console.log(`æ–°è¯„ä»·å·²æ·»åŠ : ${name} - ${currentRating}æ˜Ÿ - ${comment}`);
            alert(`è¯„ä»·æäº¤æˆåŠŸï¼æ‚¨ç»™äº† ${currentRating} æ˜Ÿè¯„åˆ†`);
        }

        // æ–°å¢å‡½æ•°ï¼šæ›´æ–°è¯¦ç»†é¡µé¢çš„è¯„åˆ†æ˜¾ç¤º
        function updateDetailViewRating() {
            const averageRating = parseFloat(calculateAverageRating(currentFood.reviews));
            const totalReviews = currentFood.reviews.length;
            
            const ratingElement = document.querySelector('.detail-rating');
            if (ratingElement) {
                ratingElement.innerHTML = `
                    <div class="stars">
                        ${generateStars(averageRating)}
                    </div>
                    <span style="color: #666;">(${totalReviews} è¯„ä»·)</span>
                `;
            }
        }

        // åˆå§‹åŒ–é¡µé¢ï¼ˆæ›´æ–°ç‰ˆï¼Œæ­£ç¡®åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            // å°è¯•ä»localStorageåŠ è½½æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®
            if (!loadFromLocalStorage()) {
                console.log('æ²¡æœ‰æ‰¾åˆ°å·²ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                streetFoods = JSON.parse(JSON.stringify(defaultStreetFoods));
                saveToLocalStorage();
            }
            
            renderFoodGrid();
            
            // åˆå§‹åŒ–è¯„åˆ†æ˜Ÿæ˜Ÿ
            initializeRatingStars();
            setRating(5);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', function(event) {
                // å¦‚æœè¯„ä»·è¡¨å•æ˜¯æ‰“å¼€çš„ï¼Œæ”¯æŒæ•°å­—é”®1-5è®¾ç½®è¯„åˆ†
                if (document.getElementById('review-form').classList.contains('active')) {
                    if (event.key >= '1' && event.key <= '5') {
                        setRating(parseInt(event.key));
                        event.preventDefault();
                    }
                }
                
                // ESCé”®å…³é—­è¯„ä»·è¡¨å•æˆ–è¿”å›ä¸»é¡µ
                if (event.key === 'Escape') {
                    if (document.getElementById('review-form').classList.contains('active')) {
                        toggleReviewForm();
                    } else if (document.getElementById('detail-view').classList.contains('active')) {
                        showMainView();
                    }
                }
            });
            
            console.log('é©¬æ¥è¥¿äºšè¡—å¤´ç¾é£Ÿè¯„ä»·ç³»ç»Ÿå·²åˆå§‹åŒ–');
            console.log('å¿«æ·é”®: æ•°å­—é”®1-5è®¾ç½®è¯„åˆ†, ESCé”®è¿”å›/å…³é—­');
        });

        // è°ƒè¯•å‡½æ•°ï¼šæ£€æŸ¥æ•°æ®å®Œæ•´æ€§
        function debugCheckData() {
            console.log('=== æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ ===');
            streetFoods.forEach(food => {
                console.log(`${food.name}:`);
                food.reviews.forEach((review, index) => {
                    console.log(`  ${index + 1}. ${review.user} - ${review.rating}æ˜Ÿ - ${review.comment}`);
                });
                console.log(`  å¹³å‡è¯„åˆ†: ${calculateAverageRating(food.reviews)}æ˜Ÿ`);
                console.log('---');
            });
            alert('è¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ç»“æœ');
        }
    </script>
</body>
</html>