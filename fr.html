<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>马来西亚街头美食评价系统</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .food-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .food-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        
        .food-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(to right, #4b6cb7, #182848);
            color: white;
        }
        
        .food-emoji {
            font-size: 3rem;
            margin-right: 15px;
        }
        
        .rating-section {
            flex-grow: 1;
        }
        
        .stars {
            color: #ffc107;
            font-size: 1.4rem;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }
        
        .star {
            cursor: default;
        }
        
        .star.clickable {
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
        }
        
        .star.clickable:hover {
            transform: scale(1.3);
        }
        
        .star.filled {
            color: #ffc107;
        }
        
        .review-count {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .food-content {
            padding: 20px;
        }
        
        .food-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .food-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .food-location {
            display: flex;
            align-items: center;
            color: #e74c3c;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .location-icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .latest-review {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .latest-review-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .latest-review-text {
            font-style: italic;
            color: #34495e;
        }
        
        .detail-view {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .detail-view.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-emoji {
            font-size: 4rem;
            margin-right: 20px;
        }
        
        .detail-info h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .detail-info p {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .detail-location {
            display: flex;
            align-items: center;
            color: #e74c3c;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .detail-rating {
            display: flex;
            align-items: center;
        }
        
        .detail-rating .stars {
            margin-right: 10px;
            margin-bottom: 0;
        }
        
        .reviews-section {
            margin-top: 25px;
        }
        
        .reviews-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .review-item {
            padding: 18px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .reviewer-info {
            display: flex;
            align-items: center;
        }
        
        .reviewer-avatar {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
        }
        
        .reviewer-details h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .review-time {
            color: #95a5a6;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .review-time span {
            margin-right: 5px;
        }
        
        .review-comment {
            color: #34495e;
            line-height: 1.5;
        }
        
        .review-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
            display: none;
        }
        
        .review-form.active {
            display: block;
            animation: slideDown 0.4s ease;
        }
        
        .review-form h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .rating-input {
            display: flex;
            align-items: center;
        }
        
        .rating-input .stars {
            margin-right: 15px;
        }
        
        .rating-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            background: #fff;
            padding: 5px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-back {
            background: #2c3e50;
            color: white;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
        }
        
        .btn-back:hover {
            background: #1a252f;
        }
        
        .btn-add-review {
            background: #27ae60;
            color: white;
            margin-top: 15px;
        }
        
        .btn-add-review:hover {
            background: #219653;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .debug-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #e74c3c;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .food-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-header {
                flex-direction: column;
                text-align: center;
            }
            
            .detail-emoji {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .review-time {
                margin-top: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>马来西亚街头美食</h1>
        <p class="subtitle">探索并评价马来西亚最受欢迎的街头美食</p>
    </header>

    <main>
        <section id="main-view">
            <div class="food-grid" id="food-grid">
                <!-- 食物卡片将通过JavaScript动态生成 -->
            </div>
        </section>

        <section id="detail-view" class="detail-view">
            <button class="btn btn-back" onclick="showMainView()">← 返回列表</button>
            
            <div class="detail-header" id="detail-header">
                <!-- 详细头部信息将通过JavaScript动态生成 -->
            </div>

            <div class="reviews-section">
                <h2>用户评价</h2>
                <div id="reviews-list">
                    <!-- 评价列表将通过JavaScript动态生成 -->
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-add-review" onclick="toggleReviewForm()">写评价</button>
            </div>

            <div id="review-form" class="review-form">
                <h3>写评价</h3>
                <div class="form-group">
                    <label for="reviewer-name">您的名字</label>
                    <input type="text" id="reviewer-name" placeholder="请输入您的名字">
                </div>
                
                <div class="form-group">
                    <label for="review-comment">您的评价</label>
                    <textarea id="review-comment" placeholder="请分享您的体验..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>评分</label>
                    <div class="rating-input">
                        <div class="stars" id="rating-stars">
                            <!-- 星星将通过JavaScript动态生成 -->
                        </div>
                        <div class="rating-value" id="rating-value">5星</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" onclick="submitReview()">提交评价</button>
                    <button class="btn btn-secondary" onclick="toggleReviewForm()">取消</button>
                </div>
            </div>
        </section>
    </main>

    <div class="debug-panel">
        <h3>调试信息</h3>
        <p>当前评分: <span id="debug-rating">5</span>星 | 当前食物ID: <span id="debug-food-id">-</span></p>
        <button class="btn btn-secondary" onclick="debugCheckData()">检查数据完整性</button>
        <button class="btn btn-secondary" onclick="resetToDefault()">重置数据</button>
    </div>

    <script>
        // 街头美食数据（自动保存到localStorage）
        let streetFoods = [];
        // 默认数据
        const defaultStreetFoods = [
            {
                id: 1,
                name: "Char Kway Teow",
                location: "Penang Road, George Town",
                emoji: "🍜",
                description: "炒粿条，马来西亚经典街头美食，使用大火炒制的扁粉条配虾、蛤蜊和韭菜",
                reviews: [
                    { user: "Ahmad", rating: 5, comment: "Best char kway teow in Penang! The wok hei is perfect!", time: "2天前" },
                    { user: "Siti", rating: 5, comment: "Amazing flavors, perfectly charred noodles", time: "1周前" },
                    { user: "Raj", rating: 4, comment: "Great taste but a bit oily", time: "2周前" }
                ]
            },
            {
                id: 2,
                name: "Nasi Lemak",
                location: "Kampung Baru, Kuala Lumpur",
                emoji: "🍛",
                description: "椰浆饭，马来西亚国菜，香浓椰浆煮制的米饭配参巴酱、花生和黄瓜",
                reviews: [
                    { user: "Fatimah", rating: 5, comment: "Authentic taste, love the sambal!", time: "1天前" },
                    { user: "Chen Wei", rating: 4, comment: "Good portion size and fresh ingredients", time: "3天前" },
                    { user: "Kumar", rating: 5, comment: "Best nasi lemak in KL!", time: "1周前" }
                ]
            },
            {
                id: 3,
                name: "Roti Canai",
                location: "Jalan Alor, Kuala Lumpur",
                emoji: "🫓",
                description: "印度煎饼，配咖喱蘸料，层次分明的薄饼搭配香浓咖喱",
                reviews: [
                    { user: "Muthu", rating: 5, comment: "Crispy and fluffy, excellent curry", time: "3天前" },
                    { user: "Sarah", rating: 4, comment: "Good but could be crispier", time: "6天前" },
                    { user: "Ali", rating: 4, comment: "Love the dhal curry!", time: "1周前" }
                ]
            },
            {
                id: 4,
                name: "Cendol",
                location: "Jonker Street, Melaka",
                emoji: "🍧",
                description: "煎蕊，马来西亚传统甜品，绿色粉条配椰浆和棕榈糖浆",
                reviews: [
                    { user: "Lim", rating: 4, comment: "Refreshing dessert, perfect for hot weather", time: "5天前" },
                    { user: "Aisha", rating: 5, comment: "Love the gula melaka!", time: "1周前" },
                    { user: "Wong", rating: 3, comment: "A bit too sweet for my taste", time: "2周前" }
                ]
            },
            {
                id: 5,
                name: "Laksa",
                location: "Gurney Drive, Penang",
                emoji: "🍲",
                description: "叻沙，酸辣面汤，浓郁椰浆汤底配米粉和各种配菜",
                reviews: [
                    { user: "David", rating: 4, comment: "Spicy and tangy, authentic flavor", time: "4天前" },
                    { user: "Priya", rating: 3, comment: "Too spicy for me but good taste", time: "1周前" },
                    { user: "Hassan", rating: 5, comment: "Best laksa I've ever had!", time: "2周前" }
                ]
            }
        ];

        let currentFood = null;
        let currentRating = 5; // 默认从5星开始

        // localStorage 数据管理
        function saveToLocalStorage() {
            try {
                localStorage.setItem('malaysiStreetFoods', JSON.stringify(streetFoods));
                console.log('数据已保存到 localStorage');
            } catch (error) {
                console.error('保存数据失败:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedFoods = localStorage.getItem('malaysiStreetFoods');
                if (savedFoods) {
                    streetFoods = JSON.parse(savedFoods);
                    console.log('从 localStorage 加载数据成功');
                    return true;
                }
            } catch (error) {
                console.error('加载数据失败:', error);
            }
            return false;
        }

        function resetToDefault() {
            streetFoods = JSON.parse(JSON.stringify(defaultStreetFoods));
            saveToLocalStorage();
            renderFoodGrid();
            alert('数据已重置为默认值');
        }

        // 计算平均评分 (确保正确计算)
        function calculateAverageRating(reviews) {
            if (!reviews || reviews.length === 0) return 0;
            
            const total = reviews.reduce((sum, review) => {
                const rating = parseInt(review.rating) || 0;
                return sum + rating;
            }, 0);
            
            const average = total / reviews.length;
            return average.toFixed(1);
        }

        // 生成星星HTML (完全修复版)
        function generateStars(rating, isClickable = false) {
            let starsHTML = '';
            const numericRating = parseFloat(rating) || 0; // 确保是数字
            
            for (let i = 1; i <= 5; i++) {
                const filled = i <= numericRating;
                const classes = `star ${filled ? 'filled' : ''} ${isClickable ? 'clickable' : ''}`;
                if (isClickable) {
                    starsHTML += `<span class="${classes}" onclick="setRating(${i})" data-rating="${i}">★</span>`;
                } else {
                    starsHTML += `<span class="${classes}">★</span>`;
                }
            }
            return starsHTML;
        }

        // 按评分排序并渲染食物卡片 (修复评分显示)
        function renderFoodGrid() {
            // 重新计算每个食物的平均评分然后排序
            const sortedFoods = [...streetFoods].sort((a, b) => {
                const avgA = parseFloat(calculateAverageRating(a.reviews));
                const avgB = parseFloat(calculateAverageRating(b.reviews));
                return avgB - avgA;
            });

            const gridHTML = sortedFoods.map(food => {
                const averageRating = parseFloat(calculateAverageRating(food.reviews));
                const totalReviews = food.reviews.length;
                const latestReview = food.reviews[0] || { comment: "暂无评价" };
                
                return `
                    <div class="food-card" onclick="showDetailView(${food.id})">
                        <div class="food-header">
                            <div class="food-emoji">${food.emoji}</div>
                            <div class="rating-section">
                                <div class="stars">
                                    ${generateStars(averageRating)}
                                </div>
                                <div class="review-count">${totalReviews} 评价</div>
                            </div>
                        </div>
                        
                        <div class="food-content">
                            <div class="food-name">${food.name}</div>
                            <div class="food-description">${food.description}</div>
                            
                            <div class="food-location">
                                <span class="location-icon">📍</span>
                                ${food.location}
                            </div>
                            
                            <div class="latest-review">
                                <div class="latest-review-label">最新评价:</div>
                                <div class="latest-review-text">"${latestReview.comment}"</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('food-grid').innerHTML = gridHTML;
        }

        // 显示详细页面 (修复评分显示)
        function showDetailView(foodId) {
            currentFood = streetFoods.find(food => food.id === foodId);
            if (!currentFood) return;

            // 更新调试信息
            document.getElementById('debug-food-id').textContent = foodId;

            // 重新计算当前食物的平均评分
            const averageRating = parseFloat(calculateAverageRating(currentFood.reviews));
            const totalReviews = currentFood.reviews.length;

            // 渲染详细页面头部
            const headerHTML = `
                <div class="detail-emoji">${currentFood.emoji}</div>
                <div class="detail-info">
                    <h1>${currentFood.name}</h1>
                    <p>${currentFood.description}</p>
                    <div class="detail-location">
                        <span style="margin-right: 8px;">📍</span>
                        ${currentFood.location}
                    </div>
                    <div class="detail-rating">
                        <div class="stars">
                            ${generateStars(averageRating)}
                        </div>
                        <span style="color: #666;">(${totalReviews} 评价)</span>
                    </div>
                </div>
            `;

            document.getElementById('detail-header').innerHTML = headerHTML;
            renderReviews();

            // 切换视图
            document.getElementById('main-view').style.display = 'none';
            document.getElementById('detail-view').classList.add('active');
        }

        // 显示主页
        function showMainView() {
            document.getElementById('main-view').style.display = 'block';
            document.getElementById('detail-view').classList.remove('active');
            document.getElementById('review-form').classList.remove('active');
        }

        // 渲染评价列表 (修复个人评价星星显示)
        function renderReviews() {
            const reviewsHTML = currentFood.reviews.map(review => {
                // 确保rating是数字类型
                const userRating = parseInt(review.rating) || 5;
                
                return `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">${review.user.charAt(0).toUpperCase()}</div>
                                <div class="reviewer-details">
                                    <h4>${review.user}</h4>
                                    <div class="stars">
                                        ${generateStars(userRating)}
                                    </div>
                                </div>
                            </div>
                            <div class="review-time">
                                <span>🕒</span> ${review.time}
                            </div>
                        </div>
                        <div class="review-comment">${review.comment}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('reviews-list').innerHTML = reviewsHTML;
        }

        // 切换评价表单（更新版，正确初始化星星）
        function toggleReviewForm() {
            const form = document.getElementById('review-form');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                // 重置表单
                document.getElementById('reviewer-name').value = '';
                document.getElementById('review-comment').value = '';
                setRating(5); // 重置为5星
            } else {
                // 表单打开时，初始化星星并设置为5星
                initializeRatingStars();
                setRating(5);
                // 聚焦到用户名输入框
                setTimeout(() => {
                    document.getElementById('reviewer-name').focus();
                }, 100);
            }
        }

        // 新增函数：初始化评分星星
        function initializeRatingStars() {
            const starsContainer = document.getElementById('rating-stars');
            if (starsContainer) {
                starsContainer.innerHTML = generateStars(5, true);
            }
        }

        // 设置评分（修复版，正确处理星星状态）
        function setRating(rating) {
            currentRating = parseInt(rating);
            const stars = document.querySelectorAll('#rating-stars .star');
            
            stars.forEach((star) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                star.classList.remove('filled');
                if (starRating <= currentRating) {
                    star.classList.add('filled');
                }
            });
            
            // 更新评分值显示
            document.getElementById('rating-value').textContent = `${currentRating}星`;
            
            // 更新调试信息
            document.getElementById('debug-rating').textContent = currentRating;
            
            // 添加视觉反馈
            stars.forEach((star) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= currentRating) {
                    star.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        star.style.transform = 'scale(1)';
                    }, 150);
                }
            });
            
            console.log(`评分设置为: ${currentRating}星`);
        }

        // 提交评价（确保评分正确保存）
        function submitReview() {
            const name = document.getElementById('reviewer-name').value.trim();
            const comment = document.getElementById('review-comment').value.trim();

            if (!name || !comment) {
                alert('请填写用户名和评价内容');
                return;
            }

            if (currentRating < 1 || currentRating > 5) {
                alert('请选择1-5星评分');
                return;
            }

            const newReview = {
                user: name,
                rating: parseInt(currentRating), // 确保保存为整数
                comment: comment,
                time: "刚刚"
            };

            // 添加新评价到当前食物的开头
            currentFood.reviews.unshift(newReview);

            // 更新streetFoods数组中的对应食物
            const foodIndex = streetFoods.findIndex(food => food.id === currentFood.id);
            if (foodIndex !== -1) {
                streetFoods[foodIndex] = { ...currentFood };
            }

            // 自动保存到localStorage
            saveToLocalStorage();

            // 重新计算并更新详细页面的平均评分显示
            updateDetailViewRating();

            // 重新渲染评价列表
            renderReviews();
            
            // 关闭评价表单
            toggleReviewForm();
            
            // 更新主页网格（重新排序和显示新的平均评分）
            renderFoodGrid();

            console.log(`新评价已添加: ${name} - ${currentRating}星 - ${comment}`);
            alert(`评价提交成功！您给了 ${currentRating} 星评分`);
        }

        // 新增函数：更新详细页面的评分显示
        function updateDetailViewRating() {
            const averageRating = parseFloat(calculateAverageRating(currentFood.reviews));
            const totalReviews = currentFood.reviews.length;
            
            const ratingElement = document.querySelector('.detail-rating');
            if (ratingElement) {
                ratingElement.innerHTML = `
                    <div class="stars">
                        ${generateStars(averageRating)}
                    </div>
                    <span style="color: #666;">(${totalReviews} 评价)</span>
                `;
            }
        }

        // 初始化页面（更新版，正确初始化所有功能）
        document.addEventListener('DOMContentLoaded', function() {
            // 尝试从localStorage加载数据，如果没有则使用默认数据
            if (!loadFromLocalStorage()) {
                console.log('没有找到已保存的数据，使用默认数据');
                streetFoods = JSON.parse(JSON.stringify(defaultStreetFoods));
                saveToLocalStorage();
            }
            
            renderFoodGrid();
            
            // 初始化评分星星
            initializeRatingStars();
            setRating(5);
            
            // 添加键盘快捷键支持
            document.addEventListener('keydown', function(event) {
                // 如果评价表单是打开的，支持数字键1-5设置评分
                if (document.getElementById('review-form').classList.contains('active')) {
                    if (event.key >= '1' && event.key <= '5') {
                        setRating(parseInt(event.key));
                        event.preventDefault();
                    }
                }
                
                // ESC键关闭评价表单或返回主页
                if (event.key === 'Escape') {
                    if (document.getElementById('review-form').classList.contains('active')) {
                        toggleReviewForm();
                    } else if (document.getElementById('detail-view').classList.contains('active')) {
                        showMainView();
                    }
                }
            });
            
            console.log('马来西亚街头美食评价系统已初始化');
            console.log('快捷键: 数字键1-5设置评分, ESC键返回/关闭');
        });

        // 调试函数：检查数据完整性
        function debugCheckData() {
            console.log('=== 数据完整性检查 ===');
            streetFoods.forEach(food => {
                console.log(`${food.name}:`);
                food.reviews.forEach((review, index) => {
                    console.log(`  ${index + 1}. ${review.user} - ${review.rating}星 - ${review.comment}`);
                });
                console.log(`  平均评分: ${calculateAverageRating(food.reviews)}星`);
                console.log('---');
            });
            alert('请在浏览器控制台查看数据完整性检查结果');
        }
    </script>
</body>
</html>